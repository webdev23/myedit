(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S={}.hasOwnProperty,x=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};a={is_unordered:false,is_counting:false,is_exclusive:false,is_solitary:false,prevent_default:false,prevent_repeat:false};w=["meta","alt","option","ctrl","shift","cmd"];y="ctrl";t={};t.debug=false;e=function(){function e(e){var t,n;for(t in e){if(!S.call(e,t))continue;n=e[t];if(n!==false){this[t]=n}}this.keys=this.keys||[];this.count=this.count||0}e.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&typeof this.on_keydown==="function"};e.prototype.reset=function(){this.count=0;return this.keyup_fired=null};return e}();t.Listener=function(){function t(e,t){var n,r,i;this.should_suppress_event_defaults=false;this.should_force_event_defaults=false;this.sequence_delay=800;this._registered_combos=[];this._keys_down=[];this._active_combos=[];this._sequence=[];this._sequence_timer=null;this._prevent_capture=false;this._defaults=t||{};for(r in a){if(!S.call(a,r))continue;i=a[r];this._defaults[r]=this._defaults[r]||i}this.element=e||document.body;n=function(e,t,n){if(e.addEventListener){e.addEventListener(t,n)}else if(e.attachEvent){e.attachEvent("on"+t,n)}return n};this.keydown_event=n(this.element,"keydown",function(e){return function(t){t=t||window.event;e._receive_input(t,true);return e._bug_catcher(t)}}(this));this.keyup_event=n(this.element,"keyup",function(e){return function(t){t=t||window.event;return e._receive_input(t,false)}}(this));this.blur_event=n(window,"blur",function(e){return function(){var t,n,r,i;i=e._keys_down;for(n=0,r=i.length;n<r;n++){t=i[n];e._key_up(t,{})}return e._keys_down=[]}}(this))}t.prototype.destroy=function(){var e;e=function(e,t,n){if(e.removeEventListener!=null){return e.removeEventListener(t,n)}else if(e.removeEvent!=null){return e.removeEvent("on"+t,n)}};e(this.element,"keydown",this.keydown_event);e(this.element,"keyup",this.keyup_event);return e(window,"blur",this.blur_event)};t.prototype._bug_catcher=function(e){var t;if(y==="cmd"&&x.call(this._keys_down,"cmd")>=0&&(t=s(e.keyCode))!=="cmd"&&t!=="shift"&&t!=="alt"&&t!=="caps"&&t!=="tab"){return this._receive_input(e,false)}};t.prototype._cmd_bug_check=function(e){if(y==="cmd"&&x.call(this._keys_down,"cmd")>=0&&x.call(e,"cmd")<0){return false}return true};t.prototype._prevent_default=function(e,t){if((t||this.should_suppress_event_defaults)&&!this.should_force_event_defaults){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}if(e.stopPropagation){return e.stopPropagation()}}};t.prototype._get_active_combos=function(e){var t,n;t=[];n=f(this._keys_down,function(t){return t!==e});n.push(e);this._match_combo_arrays(n,function(e){return function(n){if(e._cmd_bug_check(n.keys)){return t.push(n)}}}(this));this._fuzzy_match_combo_arrays(n,function(e){return function(n){if(x.call(t,n)>=0){return}if(!(n.is_solitary||!e._cmd_bug_check(n.keys))){return t.push(n)}}}(this));return t};t.prototype._get_potential_combos=function(e){var t,n,r,i,s;n=[];s=this._registered_combos;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.is_sequence){continue}if(x.call(t.keys,e)>=0&&this._cmd_bug_check(t.keys)){n.push(t)}}return n};t.prototype._add_to_active_combos=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;a=false;u=true;i=false;if(x.call(this._active_combos,e)>=0){return true}else if(this._active_combos.length){for(o=f=0,d=this._active_combos.length;0<=d?f<d:f>d;o=0<=d?++f:--f){t=this._active_combos[o];if(!(t&&t.is_exclusive&&e.is_exclusive)){continue}r=t.keys;if(!a){for(l=0,h=r.length;l<h;l++){n=r[l];a=true;if(x.call(e.keys,n)<0){a=false;break}}}if(u&&!a){v=e.keys;for(c=0,p=v.length;c<p;c++){s=v[c];u=false;if(x.call(r,s)<0){u=true;break}}}if(a){if(i){t=this._active_combos.splice(o,1)[0];if(t!=null){t.reset()}}else{t=this._active_combos.splice(o,1,e)[0];if(t!=null){t.reset()}i=true}u=false}}}if(u){this._active_combos.unshift(e)}return a||u};t.prototype._remove_from_active_combos=function(e){var t,n,r,i;for(n=r=0,i=this._active_combos.length;0<=i?r<i:r>i;n=0<=i?++r:--r){t=this._active_combos[n];if(t===e){e=this._active_combos.splice(n,1)[0];e.reset();break}}};t.prototype._get_possible_sequences=function(){var e,t,n,r,i,s,o,u,a,l,c,h,p;i=[];c=this._registered_combos;for(o=0,l=c.length;o<l;o++){e=c[o];for(n=u=1,h=this._sequence.length;1<=h?u<=h:u>=h;n=1<=h?++u:--u){s=this._sequence.slice(-n);if(!e.is_sequence){continue}if(x.call(e.keys,"shift")<0){s=f(s,function(e){return e!=="shift"});if(!s.length){continue}}for(t=a=0,p=s.length;0<=p?a<p:a>p;t=0<=p?++a:--a){if(e.keys[t]===s[t]){r=true}else{r=false;break}}if(r){i.push(e)}}}return i};t.prototype._add_key_to_sequence=function(e,t){var n,r,i,s;this._sequence.push(e);r=this._get_possible_sequences();if(r.length){for(i=0,s=r.length;i<s;i++){n=r[i];this._prevent_default(t,n.prevent_default)}if(this._sequence_timer){clearTimeout(this._sequence_timer)}if(this.sequence_delay>-1){this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay)}}else{this._sequence=[]}};t.prototype._get_sequence=function(e){var t,n,r,i,s,o,u,a,l,c,h,p,d;h=this._registered_combos;for(u=0,c=h.length;u<c;u++){t=h[u];if(!t.is_sequence){continue}for(r=a=1,p=this._sequence.length;1<=p?a<=p:a>=p;r=1<=p?++a:--a){o=f(this._sequence,function(e){if(x.call(t.keys,"shift")>=0){return true}return e!=="shift"}).slice(-r);if(t.keys.length!==o.length){continue}for(n=l=0,d=o.length;0<=d?l<d:l>d;n=0<=d?++l:--l){s=o[n];if(x.call(t.keys,"shift")<0){if(s==="shift"){continue}}if(e==="shift"&&x.call(t.keys,"shift")<0){continue}if(t.keys[n]===s){i=true}else{i=false;break}}}if(i){return t}}return false};t.prototype._receive_input=function(e,t){var n;if(this._prevent_capture){if(this._keys_down.length){this._keys_down=[]}return}n=s(e.keyCode);if(!t&&!this._keys_down.length&&(n==="alt"||n===y)){return}if(!n){return}if(t){return this._key_down(n,e)}else{return this._key_up(n,e)}};t.prototype._fire=function(e,t,n,r){if(typeof t["on_"+e]==="function"){this._prevent_default(n,t["on_"+e].call(t["this"],n,t.count,r)!==true)}if(e==="release"){t.count=0}if(e==="keyup"){return t.keyup_fired=true}};t.prototype._match_combo_arrays=function(e,t){var n,s,o,u;u=this._registered_combos;for(s=0,o=u.length;s<o;s++){n=u[s];if(!n.is_unordered&&i(e,n.keys)||n.is_unordered&&r(e,n.keys)){t(n)}}};t.prototype._fuzzy_match_combo_arrays=function(e,t){var n,r,i,s;s=this._registered_combos;for(r=0,i=s.length;r<i;r++){n=s[r];if(!n.is_unordered&&h(n.keys,e)||n.is_unordered&&c(n.keys,e)){t(n)}}};t.prototype._keys_remain=function(e){var t,n,r,i,s;s=e.keys;for(r=0,i=s.length;r<i;r++){t=s[r];if(x.call(this._keys_down,t)>=0){n=true;break}}return n};t.prototype._key_down=function(e,t){var n,r,i,s,u,a,f,l,c,h,p,d,v,m,g;c=o(e,t);if(c){e=c}this._add_key_to_sequence(e,t);l=this._get_sequence(e);if(l){this._fire("keydown",l,t)}for(u in b){i=b[u];if(!t[i]){continue}if(u===e||x.call(this._keys_down,u)>=0){continue}this._keys_down.push(u)}for(u in b){i=b[u];if(u===e){continue}if(x.call(this._keys_down,u)>=0&&!t[i]){if(u==="cmd"&&y!=="cmd"){continue}for(s=h=0,g=this._keys_down.length;0<=g?h<g:h>g;s=0<=g?++h:--h){if(this._keys_down[s]===u){this._keys_down.splice(s,1)}}}}r=this._get_active_combos(e);f=this._get_potential_combos(e);for(p=0,v=r.length;p<v;p++){n=r[p];this._handle_combo_down(n,f,e,t)}if(f.length){for(d=0,m=f.length;d<m;d++){a=f[d];this._prevent_default(t,a.prevent_default)}}if(x.call(this._keys_down,e)<0){this._keys_down.push(e)}};t.prototype._handle_combo_down=function(e,t,n,r){var i,s,o,u,a,f;if(x.call(e.keys,n)<0){return false}this._prevent_default(r,e&&e.prevent_default);i=false;if(x.call(this._keys_down,n)>=0){i=true;if(!e.allows_key_repeat()){return false}}u=this._add_to_active_combos(e,n);e.keyup_fired=false;s=false;if(e.is_exclusive){for(a=0,f=t.length;a<f;a++){o=t[a];if(o.is_exclusive&&o.keys.length>e.keys.length){s=true;break}}}if(!s){if(e.is_counting&&typeof e.on_keydown==="function"){e.count+=1}if(u){return this._fire("keydown",e,r,i)}}};t.prototype._key_up=function(e,t){var n,r,i,s,u,a,f,l,c,h,p,d,v,g,y,b,w,E,S;l=e;f=o(e,t);if(f){e=f}f=m[l];if(t.shiftKey){if(!(f&&x.call(this._keys_down,f)>=0)){e=l}}else{if(!(l&&x.call(this._keys_down,l)>=0)){e=f}}a=this._get_sequence(e);if(a){this._fire("keyup",a,t)}if(x.call(this._keys_down,e)<0){return false}for(u=c=0,b=this._keys_down.length;0<=b?c<b:c>b;u=0<=b?++c:--c){if((w=this._keys_down[u])===e||w===f||w===l){this._keys_down.splice(u,1);break}}r=this._active_combos.length;s=[];E=this._active_combos;for(h=0,v=E.length;h<v;h++){n=E[h];if(x.call(n.keys,e)>=0){s.push(n)}}for(p=0,g=s.length;p<g;p++){i=s[p];this._handle_combo_up(i,t,e)}if(r>1){S=this._active_combos;for(d=0,y=S.length;d<y;d++){n=S[d];if(n===void 0||x.call(s,n)>=0){continue}if(!this._keys_remain(n)){this._remove_from_active_combos(n)}}}};t.prototype._handle_combo_up=function(e,t,n){var i,s;this._prevent_default(t,e&&e.prevent_default);s=this._keys_remain(e);if(!e.keyup_fired){i=this._keys_down.slice();i.push(n);if(!e.is_solitary||r(i,e.keys)){this._fire("keyup",e,t);if(e.is_counting&&typeof e.on_keyup==="function"&&typeof e.on_keydown!=="function"){e.count+=1}}}if(!s){this._fire("release",e,t);this._remove_from_active_combos(e)}};t.prototype.simple_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t})};t.prototype.counting_combo=function(e,t){return this.register_combo({keys:e,is_counting:true,is_unordered:false,on_keydown:t})};t.prototype.sequence_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t,is_sequence:true})};t.prototype.register_combo=function(t){var n,r,i,s;if(typeof t["keys"]==="string"){t["keys"]=t["keys"].split(" ")}s=this._defaults;for(r in s){if(!S.call(s,r))continue;i=s[r];if(t[r]===void 0){t[r]=i}}n=new e(t);if(E(n)){this._registered_combos.push(n);return n}};t.prototype.register_many=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(this.register_combo(t))}return i};t.prototype.unregister_combo=function(t){var n,s,o,u,a,f;if(!t){return false}s=function(e){return function(t){var n,r,i,s;s=[];for(n=r=0,i=e._registered_combos.length;0<=i?r<i:r>i;n=0<=i?++r:--r){if(t===e._registered_combos[n]){e._registered_combos.splice(n,1);break}else{s.push(void 0)}}return s}}(this);if(t instanceof e){return s(t)}else{if(typeof t==="string"){t=t.split(" ")}a=this._registered_combos;f=[];for(o=0,u=a.length;o<u;o++){n=a[o];if(n==null){continue}if(n.is_unordered&&r(t,n.keys)||!n.is_unordered&&i(t,n.keys)){f.push(s(n))}else{f.push(void 0)}}return f}};t.prototype.unregister_many=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(this.unregister_combo(t))}return i};t.prototype.get_registered_combos=function(){return this._registered_combos};t.prototype.reset=function(){return this._registered_combos=[]};t.prototype.listen=function(){return this._prevent_capture=false};t.prototype.stop_listening=function(){return this._prevent_capture=true};t.prototype.get_meta_key=function(){return y};return t}();u=function(){if(navigator.userAgent.indexOf("Mac OS X")!==-1){y="cmd"}};n=function(){if(navigator.userAgent.indexOf("Opera")!==-1){v["17"]="cmd"}};s=function(e){return v[e]};f=function(e,t){var n;if(e.filter){return e.filter(t)}else{return function(){var r,i,s;s=[];for(r=0,i=e.length;r<i;r++){n=e[r];if(t(n)){s.push(n)}}return s}()}};r=function(e,t){var n,r,i;if(e.length!==t.length){return false}for(r=0,i=e.length;r<i;r++){n=e[r];if(x.call(t,n)>=0){continue}return false}return true};i=function(e,t){var n,r,i;if(e.length!==t.length){return false}for(n=r=0,i=e.length;0<=i?r<i:r>i;n=0<=i?++r:--r){if(e[n]!==t[n]){return false}}return true};c=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++){n=e[r];if(x.call(t,n)<0){return false}}return true};l=Array.prototype.indexOf||function(e,t){var n,r,i;for(n=r=0,i=e.length;0<=i?r<=i:r>=i;n=0<=i?++r:--r){if(e[n]===t){return n}}return-1};h=function(e,t){var n,r,i,s,o;i=0;for(s=0,o=e.length;s<o;s++){r=e[s];n=l.call(t,r);if(n>=i){i=n}else{return false}}return true};g=function(){if(t.debug){return console.log.apply(console,arguments)}};p=function(e){var t,n,r;t=false;for(r in v){n=v[r];if(e===n){t=true;break}}if(!t){for(r in m){n=m[r];if(e===n){t=true;break}}}return t};E=function(e){var t,n,r,i,s,o,u,f,c,h,v,m,b,E,S;u=true;if(!e.keys.length){g("You're trying to bind a combo with no keys:",e)}for(n=c=0,E=e.keys.length;0<=E?c<E:c>E;n=0<=E?++c:--c){r=e.keys[n];t=d[r];if(t){r=e.keys[n]=t}if(r==="meta"){e.keys.splice(n,1,y)}if(r==="cmd"){g('Warning: use the "meta" key rather than "cmd" for Windows compatibility')}}S=e.keys;for(h=0,m=S.length;h<m;h++){r=S[h];if(!p(r)){g('Do not recognize the key "'+r+'"');u=false}}if(x.call(e.keys,"meta")>=0||x.call(e.keys,"cmd")>=0){s=e.keys.slice();for(v=0,b=w.length;v<b;v++){i=w[v];if((n=l.call(s,i))>-1){s.splice(n,1)}}if(s.length>1){g("META and CMD key combos cannot have more than 1 non-modifier keys",e,s);u=false}}for(o in e){f=e[o];if(a[o]==="undefined"){g("The property "+o+" is not a valid combo property. Your combo has still been registered.")}}return u};o=function(e,t){var n;if(!t.shiftKey){return false}n=m[e];if(n!=null){return n}return false};b={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"};d={escape:"esc",control:"ctrl",command:"cmd","break":"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"};m={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"};v={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"-",173:"="};t._keycode_dictionary=v;t._is_array_in_array_sorted=h;u();n();if(typeof define==="function"&&define.amd){define([],function(){return t})}else if(typeof exports!=="undefined"&&exports!==null){exports.keypress=t}else{window.keypress=t}}).call(this)
